<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hello Kitty Uploader</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --pink:#ff8fb1;
    --hot:#ff4f88;
    --bg:#fff5f8;
    --ink:#333;
    --white:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:
      radial-gradient(circle at 20% 0%, #ffe0ea 0%, rgba(255,224,234,0) 30%),
      radial-gradient(circle at 80% 100%, #ffeaf1 0%, rgba(255,234,241,0) 35%),
      var(--bg);
    font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--ink);
    display:flex; flex-direction:column; align-items:center; justify-content:center; gap:24px; padding:18px;
  }

  /* Header */
  h1{
    margin:0; font-size:clamp(22px, 4vw, 32px); font-weight:900; color:#ff2e74;
    letter-spacing:.02em;
  }

  /* Heart frame around image */
  .heart-wrap{
    position:relative; width:min(720px, 92vw); aspect-ratio:1; display:grid; place-items:center;
  }
  .heart{
    position:absolute; inset:0;
  }
  .heart svg{
    width:100%; height:100%;
    filter: drop-shadow(0 8px 18px rgba(255,79,136,.25));
  }
  .heart path{
    fill:none; stroke: var(--hot); stroke-width:16; stroke-linecap:round; stroke-linejoin:round;
  }
  .pic{
    max-width:55%; max-height:55%; border-radius:22px;
    box-shadow: 0 10px 26px rgba(0,0,0,.12);
    background: var(--white);
  }

  /* Buttons area */
  .controls{
    display:flex; gap:14px; flex-wrap:wrap; align-items:center; justify-content:center;
  }
  .btn{
    appearance:none; border:none; cursor:pointer; font-weight:800;
    padding:14px 18px; border-radius:999px; letter-spacing:.02em;
    background: linear-gradient(180deg, #ffc4d6, #ff8fb1);
    color:#7a113b; box-shadow: 0 6px 14px rgba(255,79,136,.25), inset 0 1px 0 #fff;
    transition: transform .06s ease, filter .15s ease, opacity .15s ease;
  }
  .btn:hover{filter:brightness(1.04)}
  .btn:active{transform: translateY(1px)}
  .btn[disabled]{opacity:.6; cursor:not-allowed}
  .btn.delete{
    background: linear-gradient(180deg, #ffd3dc, #ff9abf);
  }

  .status{
    min-height:1.6em; font-size:14px; color:#7a113b; text-align:center;
  }

  /* Hello-Kitty bow accent in the corner */
  .bow{
    position:fixed; top:10px; right:12px; width:min(18vw,120px); opacity:.85; pointer-events:none;
  }
</style>
</head>
<body>
  <img class="bow" alt="" src="data:image/svg+xml;utf8,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 120'>
      <path d='M55 60c-20-18-35-30-45-24-8 5-10 24 10 36 18 11 47 10 58 7-3-15-9-22-23-19z' fill='%23ff8fb1' stroke='%23ff4f88' stroke-width='4'/>
      <circle cx='100' cy='62' r='20' fill='%23ff8fb1' stroke='%23ff4f88' stroke-width='4'/>
      <path d='M145 60c20-18 35-30 45-24 8 5 10 24-10 36-18 11-47 10-58 7-3-15 9-22 23-19z' fill='%23ff8fb1' stroke='%23ff4f88' stroke-width='4'/>
    </svg>"/>

  <h1>Webserv</h1>

  <div class="heart-wrap" aria-label="Greatness photo in a heart frame">
    <div class="heart" aria-hidden="true">
      <svg viewBox="0 0 100 90" preserveAspectRatio="xMidYMid meet">
        <path d="M50 82
                 C 40 70, 20 55, 12 42
                 C 2 27, 10 10, 27 10
                 C 38 10, 45 17, 50 24
                 C 55 17, 62 10, 73 10
                 C 90 10, 98 27, 88 42
                 C 80 55, 60 70, 50 82 Z"/>
      </svg>
    </div>
    <img class="pic" src="./greatness.jpeg" alt="greatness" />
  </div>

  <div class="controls">
    <button id="uploadBtn" class="btn">Upload</button>
    <button id="deleteBtn" class="btn delete">Delete</button>
  </div>
  <div id="status" class="status" role="status" aria-live="polite"></div>

  <input id="fileInput" type="file" multiple hidden />

<script>
  // ======= Configure to match your server =======
  const UPLOAD_ENDPOINT   = "/upload"; // POST target for uploads (raw body)
  const UPLOADS_BASE_PATH = "/upload"; // served path for uploaded files (used for DELETE)
  const REQUEST_TIMEOUT_MS = 30000;
  // ==============================================

  const statusEl  = document.getElementById('status');
  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const deleteBtn = document.getElementById('deleteBtn');

  function setStatus(msg){ statusEl.textContent = msg; }
  function setBusy(b){
    uploadBtn.disabled = b;
    deleteBtn.disabled = b;
  }

  function explainStatus(code){
    const map = {
      400: "Bad Request — the server couldn't parse the request.",
      401: "Unauthorized — authentication required or invalid.",
      403: "Forbidden — the server denied permission.",
      404: "Not Found — file or path doesn't exist.",
      405: "Method Not Allowed — server doesn't allow this method.",
      408: "Request Timeout — the server timed out waiting for data.",
      409: "Conflict — a file with that name may already exist.",
      413: "Payload Too Large — file exceeds allowed size.",
      415: "Unsupported Media Type — content-type not accepted.",
      422: "Unprocessable Content — validation failed.",
      429: "Too Many Requests — you're being rate limited.",
      500: "Internal Server Error — something broke on the server.",
      501: "Not Implemented — endpoint/method not supported.",
      503: "Service Unavailable — server is temporarily down.",
      507: "Insufficient Storage — server can't store or remove the file."
    };
    if (map[code]) return map[code];
    if (code >= 500) return "Server error.";
    if (code >= 400) return "Client error.";
    return "OK";
  }

  async function readErrorBody(response){
    try{
      const txt = await response.text();
      const trimmed = (txt || "").trim();
      if (!trimmed) return "";
      return trimmed.length > 200 ? (trimmed.slice(0, 200) + "…") : trimmed;
    }catch{
      return "";
    }
  }

  function withTimeout(ms){
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), ms);
    return { signal: controller.signal, cancel: () => clearTimeout(id) };
  }

  // Upload button → open picker
  uploadBtn.addEventListener('click', () => {
    fileInput.value = "";
    fileInput.click();
  });

  // When a file is selected
  fileInput.addEventListener('change', async () => {
    if (!fileInput.files.length) {
      setStatus('Please select a file.');
      return;
    }

    const file = fileInput.files[0];

    setBusy(true);
    setStatus(`Uploading ${file.name}…`);

    const timeout = withTimeout(REQUEST_TIMEOUT_MS);
    try{
      const resp = await fetch(UPLOAD_ENDPOINT, {
        method: 'POST',
        headers: {
          'X-Filename': encodeURIComponent(file.name),
          'Content-Type': 'application/octet-stream'
        },
        body: file,
        signal: timeout.signal
      });

      if (resp.ok) {
        setStatus(`Upload complete: ${file.name} ✓ (HTTP ${resp.status})`);
      } else {
        const detail = await readErrorBody(resp);
        const line2 = detail ? ` Details: ${detail}` : "";
        setStatus(`Upload failed ✗ (HTTP ${resp.status}: ${explainStatus(resp.status)}).${line2}`);
      }
    } catch (err) {
      if (err.name === 'AbortError') {
        setStatus("Upload cancelled due to timeout.");
      } else if (err.name === 'NotAllowedError' || err.name === 'SecurityError') {
        setStatus("Upload blocked by browser or permissions.");
      } else {
        setStatus("Network error during upload. Check your connection or server.");
      }
      console.error('Upload error:', err);
    } finally {
      timeout.cancel();
      setBusy(false);
    }
  });

  // Delete flow: prompt → DELETE /upload/<name>
  deleteBtn.addEventListener('click', async () => {
    const name = (prompt("Enter the exact filename to delete (e.g. myfile.txt):") || "").trim();
    if (!name){ setStatus("Delete cancelled."); return; }

    setBusy(true);
    setStatus("Deleting…");

    const timeout = withTimeout(REQUEST_TIMEOUT_MS);
    try{
      const resp = await fetch(`${UPLOADS_BASE_PATH}/${encodeURIComponent(name)}`, {
        method: "DELETE",
        signal: timeout.signal
      });

      // Treat only 200 OK or 204 No Content as success
      if (resp.status === 200 || resp.status === 204) {
        setStatus(`Deleted ✓ (HTTP ${resp.status})`);
      } else {
        const detail = await readErrorBody(resp);
        const friendly = explainStatus(resp.status);
        const line2 = detail ? ` Details: ${detail}` : "";
        setStatus(`Delete failed ✗ (HTTP ${resp.status}: ${friendly}).${line2}`);
      }
    } catch (e) {
      if (e.name === 'AbortError') {
        setStatus("Delete cancelled due to timeout.");
      } else {
        setStatus("Network error during delete.");
      }
      console.error('Error during delete:', e);
    } finally {
      timeout.cancel();
      setBusy(false);
    }
  });
</script>
</body>
</html>
